---
title: "R Bootcamp Einstein 2017 Session 2"
author: Michoel Snow
date: August 8 & 10, 2017
output: 
  revealjs::revealjs_presentation:
    center: FALSE
    theme: sky
    transition: concave
    css: r_bootcamp_einstein_2017_revealjs.css
    highlight: tango
    fig_height: 5
    reveal_options:
      width: '100%'
      height: '100%'
      margin: 0.1
---
```{r global_options, include=FALSE, warning=FALSE}
options(width = 120)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=120),width=120,tidy=TRUE)
```

```{r, echo=FALSE,include=FALSE}
library(tidyverse)
library(NHANES)
library(lubridate)
```


## Example presentations

## NHANES Sex & Drugs {.scrollable}

Correlation does not imply causation!
```{r, tidy =FALSE}
nh_tbl <- as_tibble(NHANES)
nh_tbl_sex <- nh_tbl %>% filter(!is.na(SexOrientation))
nh_tbl_sex %>% ggplot(aes(SexOrientation)) + geom_bar(fill="blue")
nh_tbl_sex %>% ggplot(aes(SexOrientation)) + geom_bar(aes(fill=Gender),position="dodge")
nh_tbl_sex %>% filter(SexOrientation!="Heterosexual") %>% 
  ggplot(aes(SexOrientation,fill=Gender)) + geom_bar(position="dodge")
nh_tbl_sex %>% filter(SexOrientation!="Heterosexual") %>% 
  ggplot(aes(SexOrientation,fill=SameSex)) + geom_bar(position="dodge")
nh_tbl_sex %>% filter(!is.na(SameSex), SexOrientation=="Heterosexual",SameSex == "Yes") %>% 
  ggplot(aes(Gender,fill=Gender)) + geom_bar() + 
  labs(title = "Identify as Heterosexual with Same Sex Experience") +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r, warning=FALSE, tidy=FALSE}
nh_tbl_mj <- nh_tbl %>% filter(!is.na(Marijuana)) 
nh_tbl_mj %>% ggplot(aes(Age,fill=Marijuana)) + geom_bar(position="dodge")
nh_tbl_mj %>% ggplot(aes(Age,fill=RegularMarij)) + geom_bar(position="dodge")
nh_tbl_mj %>% filter(!is.na(HardDrugs)) %>% filter(HardDrugs=="Yes") %>% ggplot(aes(Marijuana)) + geom_bar(fill = "Blue") + 
  labs(title = "Participants who have tried cocaine, crack cocaine, heroin or methamphetamine") +
  theme(plot.title = element_text(hjust = 0.5))
nh_tbl_mj %>% filter(!is.na(HardDrugs)) %>% filter(Marijuana=="Yes") %>% ggplot(aes(HardDrugs)) + geom_bar(fill = "Blue") + 
  labs(title = "Participants who have tried marijuana") +
  theme(plot.title = element_text(hjust = 0.5))

```

## Citibike {.scrollable}

```{r}
column_names <- c('trip_duration','start_time', 'stop_time', 'start_id', 'start_name', 'end_id', 'end_name', 'bike_id', 'user_type', 'birth_year', 'gender')
citi_bike <- read_csv('./data/201701-citibike-tripdata.csv',col_names = column_names, skip=1)
```

```{r}
citi_bike %>% mutate(start_hr = hour(start_time)) %>% 
  ggplot(aes(start_hr)) + geom_histogram(bins=24,fill="blue",color="black")
citi_bike %>% mutate(day_of_week = wday(start_time)) %>% 
  ggplot(aes(day_of_week)) + geom_histogram(bins=7,fill="blue",color="black")
```

```{r}
citi_bike %>% mutate(travel_time = as.double(stop_time-start_time)) %>% 
  ggplot(aes(travel_time)) + geom_histogram(bins=30)
citi_bike %>% mutate(travel_time = as.double(stop_time-start_time)) %>% filter(travel_time<80) %>% 
  ggplot(aes(travel_time)) + geom_histogram(stat = "density")
```

```{r}
citi_bike %>% mutate(travel_time = as.double(stop_time-start_time), start_min = min(start_time)) %>% filter(travel_time<80) %>% 
  ggplot(aes(start_time,travel_time)) + geom_jitter()
```

## 
```{r}
brfss <- read_csv('./data/BRFSS.csv')
brfss <- brfss %>% rename(STATE=`_STATE`)
brfss <- brfss %>% select(-c(POORHLTH,CHECKUP1))
```

```{r}
brfss$CVDINFR4 <- recode(brfss$CVDINFR4,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$HLTHPLN1 <- recode(brfss$HLTHPLN1,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$GENHLTH <- recode(brfss$GENHLTH,`1`= 'Excellent',`2` = 'Very Good', `3` = "Good", `4` = "Fair", `5` = "Poor",.default = NA_character_)
brfss$PERSDOC2 <- recode(brfss$PERSDOC2,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$MEDCOST <- recode(brfss$MEDCOST,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$BPHIGH4 <- recode(brfss$BPHIGH4,`1`= 'YES',`3` = 'NO', .default = NA_character_)
brfss$BPMEDS <- recode(brfss$BPMEDS,`1`= 'YES',`3` = 'NO', .default = NA_character_)
brfss$BLOODCHO <- recode(brfss$BLOODCHO,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$TOLDHI2 <- recode(brfss$TOLDHI2,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$CVDCRHD4 <- recode(brfss$CVDCRHD4,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$CVDSTRK3 <- recode(brfss$CVDSTRK3,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$ASTHMA3 <- recode(brfss$ASTHMA3,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$ASTHNOW <- recode(brfss$ASTHNOW,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$CHCSCNCR <- recode(brfss$CHCSCNCR,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$CHCOCNCR <- recode(brfss$CHCOCNCR,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$CHCCOPD1 <- recode(brfss$CHCCOPD1,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$HAVARTH3 <- recode(brfss$HAVARTH3,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$ADDEPEV2 <- recode(brfss$ADDEPEV2,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$CHCKIDNY <- recode(brfss$CHCKIDNY,`1`= 'YES',`2` = 'NO', .default = NA_character_)
brfss$DIABETE3 <- recode(brfss$DIABETE3,`1`= 'YES',`3` = 'NO', .default = NA_character_)
brfss$DIABAGE2[brfss$DIABAGE2>=98] <- NA
brfss$SEX <- recode(brfss$SEX,`1`= 'MALE',`2` = 'FEMALE', .default = NA_character_)
brfss$MARITAL <- recode(brfss$MARITAL,`1`= 'MARRIED',`2` = 'DIVORCED', `3` = 'WIDOWED', `4` = 'SEPARATED', `5` = 'NEVER MARRIED', `6` = 'UNMARRIED COUPLE', .default = NA_character_)
brfss$CHCKIDNY <- recode(brfss$CHCKIDNY,`1`= 'NO SCHOOL',`2` = 'ELEMENTARY', `3`='SOME HIGH SCHOOL'
                         , .default = NA_character_)



```


```{r}
brfss %>% filter(CVDINFR4==1) %>% group_by(STATE) %>% summarise(MI = sum(CVDINFR4), count = n()) %>% ggplot(aes(STATE,MI)) +
  geom_point()

```


```{r}
brfss %>% filter(!is.na(HLTHPLN1),!is.na(CVDINFR4)) %>% ggplot(aes(HLTHPLN1)) + 
  geom_bar(aes(fill=CVDINFR4),position = "dodge")
brfss %>% filter(!is.na(HLTHPLN1),!is.na(CVDINFR4)) %>% ggplot(aes(CVDINFR4,fill=HLTHPLN1)) + 
  geom_bar(position = "dodge")

```


<!-- aa <- read_xpt('./data/LLCP2015.XPT') -->
<!-- cc <- as_tibble(aa) -->
<!-- cc <- cc %>% select(-c(SEQNO,`_PSU`)) -->
<!-- cc <- cc %>% select(-c(DISPCODE,IDATE,CTELENUM,PVTRESD1,COLGHOUS,STATERES,CELLFON3,CTELNUM1,CELLFON2,LANDLINE,CSTATE,PVTRESD2,CCLGHOUS,RENTHOM1,NUMHHOL2,NUMPHON2,CPDEMO1,INTERNET,ARTHDIS2,ARTHSOCL,DIABEDU,PAINACT2,CAREGIV1,CRGVREL1,CRGVLNG1,CRGVHRS1,CRGVPRB1,CRGVPERS,CRGVHOUS,CRGVMST2,CRGVEXPT,SCNTMNY1,SCNTMEL1,SCNTPAID,SCNTLPAD,EMTSUPRT,LSATISFY,QSTVER,EXACTOT1,EXACTOT2,MSCODE,`_STSTR`,`_STRWT`,`_RAWRAKE`,`_WT2RAKE`,`_CLLCPWT`,`_DUALUSE`,`_DUALCOR`,`_LLCPWT`,`_RFHLTH`,`_HCVU651`,`_RFHYPE5`,`_CHOLCHK`,`_RFCHOL`,`_MICHD`,`_LTASTH1`:`_AIDTST3`)) -->
<!-- write_csv(cc,'./data/BRFSS.csv') -->